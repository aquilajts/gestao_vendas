<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Contratação - Monte seu Plano</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-900 text-white font-sans min-h-screen flex flex-col items-center justify-center px-4">
  <div class="max-w-4xl w-full">
    <h1 class="text-3xl font-bold text-center mb-8">Monte seu plano</h1>

    <!-- Etapa 1: Adesivo -->
    <div id="etapa1" class="space-y-6">
      <h2 class="text-xl font-semibold mb-4">Adesivo</h2>

      <label class="flex items-center gap-2">
        <input type="checkbox" id="adesivo" class="form-checkbox text-blue-500" onchange="atualizarBeneficios()" />
        Aceito adesivar meu veículo e ganhar benefícios
      </label>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-4" id="beneficiosContainer" style="display: none;">
        <label class="bg-white text-black rounded p-4 block">
          <input type="checkbox" name="beneficio" value="-20" /> Desconto mensal de R$ 20,00
        </label>
        <label class="bg-white text-black rounded p-4 block">
          <input type="checkbox" name="beneficio" value="-20" /> VFLR incluso gratuitamente
        </label>
        <label class="bg-white text-black rounded p-4 block">
          <input type="checkbox" name="beneficio" value="0" /> R$1.000,00 de desconto na participação
        </label>
      </div>

      <div class="mt-8 bg-gray-800 p-4 rounded">
        <h3 class="text-lg font-semibold mb-2">Subtotal</h3>
        <p id="subtotalSeguro">Seguro: <span class="text-red-400 font-bold">R$ 0,00</span></p>
        <p id="subtotalDesconto">Descontos: <span class="text-green-300 font-bold">- R$ 0,00</span></p>
        <p id="subtotalAdicionais">Adicionais: <span class="text-red-400 font-bold">R$ 0,00</span></p>
        <p id="subtotalFinal">Subtotal Final: <span class="text-white font-bold">R$ 0,00</span></p>
      </div>

      <div class="flex justify-end">
        <button onclick="irParaEtapa2()" class="mt-4 bg-blue-600 hover:bg-blue-700 text-white py-2 px-6 rounded font-semibold">Próxima</button>
      </div>
    </div>

    <!-- Etapa 2: Serviços Principais -->
    <div id="etapa2" class="space-y-8 hidden">
      <h2 class="text-xl font-semibold mb-4">Serviços Inclusos</h2>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <!-- Guincho -->
        <div class="bg-white text-black rounded p-4">
          <h3 class="font-bold mb-2">Guincho</h3>
          <label class="block"><input type="radio" name="guincho" value="0" checked> 200KM (R$0,00)</label>
          <label class="block"><input type="radio" name="guincho" value="30"> 400KM (R$30,00)</label>
          <label class="block"><input type="radio" name="guincho" value="50"> 800KM (R$50,00)</label>
        </div>

        <!-- Proteção Terceiros -->
        <div class="bg-white text-black rounded p-4">
          <h3 class="font-bold mb-2">Proteção a Terceiros</h3>
          <label class="block"><input type="radio" name="terceiros" value="0" checked> R$40.000 (R$0,00)</label>
          <label class="block"><input type="radio" name="terceiros" value="30"> R$70.000 (R$30,00)</label>
        </div>

        <!-- Rastreador -->
        <div class="bg-white text-black rounded p-4">
          <h3 class="font-bold mb-2">Rastreador</h3>
          <label class="block"><input type="radio" name="rastreador" value="0" id="rastreadorNao"> Não</label>
          <label class="block"><input type="radio" name="rastreador" value="30" id="rastreadorSim"> Sim (R$30,00)</label>
        </div>
      </div>

      <div class="flex justify-between">
        <button onclick="voltarEtapa1()" class="mt-4 bg-gray-600 hover:bg-gray-700 text-white py-2 px-6 rounded font-semibold">Voltar</button>
        <button onclick="irParaEtapa3()" class="mt-4 bg-blue-600 hover:bg-blue-700 text-white py-2 px-6 rounded font-semibold">Próxima</button>
      </div>

      <div class="mt-8 bg-gray-800 p-4 rounded">
        <h3 class="text-lg font-semibold mb-2">Subtotal</h3>
        <p id="subtotalSeguro">Seguro: <span class="text-red-400 font-bold">R$ 0,00</span></p>
        <p id="subtotalDesconto">Descontos: <span class="text-green-300 font-bold">- R$ 0,00</span></p>
        <p id="subtotalAdicionais">Adicionais: <span class="text-red-400 font-bold">R$ 0,00</span></p>
        <p id="subtotalFinal">Subtotal Final: <span class="text-white font-bold">R$ 0,00</span></p>
      </div>
    </div>

    <!-- Etapa 3: Adicionais -->
    <div id="etapa3" class="space-y-8 hidden">
      <h2 class="text-xl font-semibold mb-4">Adicionais</h2>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <!-- VFLR -->
        <div class="bg-white text-black rounded p-4">
          <h3 class="font-bold mb-2">Vidros, Faróis, Lanternas e Retrovisores</h3>
          <label class="block"><input type="radio" name="vflr" value="0" checked> Não (R$0,00)</label>
          <label class="block"><input type="radio" name="vflr" value="20"> Sim (R$20,00)</label>
        </div>

        <!-- Incêndio e Alagamento -->
        <div class="bg-white text-black rounded p-4">
          <h3 class="font-bold mb-2">Incêndio e Alagamento</h3>
          <label class="block"><input type="radio" name="incendio" value="0" checked> Não (R$0,00)</label>
          <label class="block"><input type="radio" name="incendio" value="25"> Sim (R$25,00)</label>
        </div>

        <!-- Proteção Baú -->
        <div class="bg-white text-black rounded p-4">
          <h3 class="font-bold mb-2">Proteção para Baú (se aplicável)</h3>
          <label class="block"><input type="radio" name="bau" value="0" checked> Não (R$0,00)</label>
          <label class="block"><input type="radio" name="bau" value="90"> Sim (R$90,00)</label>
        </div>
      </div>

      <div class="flex justify-between">
        <button onclick="voltarEtapa2()" class="mt-4 bg-gray-600 hover:bg-gray-700 text-white py-2 px-6 rounded font-semibold">Voltar</button>
        <button onclick="irParaEtapa4()" class="mt-4 bg-blue-600 hover:bg-blue-700 text-white py-2 px-6 rounded font-semibold">Próxima</button>
      </div>

      <div class="mt-8 bg-gray-800 p-4 rounded">
        <h3 class="text-lg font-semibold mb-2">Subtotal</h3>
        <p id="subtotalSeguro">Seguro: <span class="text-red-400 font-bold">R$ 0,00</span></p>
        <p id="subtotalDesconto">Descontos: <span class="text-green-300 font-bold">- R$ 0,00</span></p>
        <p id="subtotalAdicionais">Adicionais: <span class="text-red-400 font-bold">R$ 0,00</span></p>
        <p id="subtotalFinal">Subtotal Final: <span class="text-white font-bold">R$ 0,00</span></p>
      </div>
    </div>

    <!-- Etapa 4: Dados do Cliente -->
    <div id="etapa4" class="space-y-6 hidden">
      <h2 class="text-xl font-semibold mb-4">Preencha seus dados</h2>
    
      <div class="space-y-4">
        <input required id="cliente_nome" class="w-full p-2 rounded bg-gray-800 text-white" placeholder="Nome completo *" />
        <input required id="cliente_telefone" class="w-full p-2 rounded bg-gray-800 text-white" placeholder="Telefone com DDD *" />
        <input required id="cliente_placa" class="w-full p-2 rounded bg-gray-800 text-white" placeholder="Placa | se for 2 ou mais, informe tambem!" />
      </div>
    
      <p class="text-sm text-gray-300 mt-4">
        Preencha todos os campos para seguir com a contratação sem intermédio de um vendedor.<br />
        Se desejar contato com um representante, clique em finalizar após preencher nome, telefone e placa.<br />
        <strong>Não se preocupe</strong>, se houver descontos ou campanhas, iremos contatar!
      </p>

      <!-- Novos campos opcionais -->
      <div class="space-y-4">
        <input id="cliente_rua" class="w-full p-2 rounded bg-gray-800 text-white" placeholder="Rua" />
        <input id="cliente_numero" class="w-full p-2 rounded bg-gray-800 text-white" placeholder="Número" />
        <input id="cliente_bairro" class="w-full p-2 rounded bg-gray-800 text-white" placeholder="Bairro" />
        <input id="cliente_cidade" class="w-full p-2 rounded bg-gray-800 text-white" placeholder="Cidade" />
        <input id="cliente_cep" class="w-full p-2 rounded bg-gray-800 text-white" placeholder="CEP" />
        <input id="cliente_uf" class="w-full p-2 rounded bg-gray-800 text-white" placeholder="UF" />
        <input id="cliente_telefone_pessoal" class="w-full p-2 rounded bg-gray-800 text-white" placeholder="Telefone pessoal" />
        <input id="cliente_telefone_recado" class="w-full p-2 rounded bg-gray-800 text-white" placeholder="Telefone de recado" />
        <input id="cliente_email" class="w-full p-2 rounded bg-gray-800 text-white" placeholder="E-mail" />
      </div>

      <div class="mt-6 text-right">
        <button onclick="voltarEtapa3()" class="bg-gray-600 hover:bg-gray-700 text-white py-2 px-6 rounded font-semibold">Voltar</button>
        <button onclick="enviarFormulario()" class="bg-green-600 hover:bg-green-700 text-white py-2 px-6 rounded font-semibold">Finalizar</button>
      </div>
    </div>
  </div>

<script>
  function irParaEtapa1() {
    esconderEtapas();
    document.getElementById("etapa1").classList.remove("hidden");
    atualizarTotais();
  }

  function irParaEtapa2() {
    esconderEtapas();
    document.getElementById("etapa2").classList.remove("hidden");
    atualizarTotais();
  }

  function irParaEtapa3() {
    esconderEtapas();
    document.getElementById("etapa3").classList.remove("hidden");
    atualizarTotais();
  }

  function irParaEtapa4() {
    esconderEtapas();
    document.getElementById("etapa4").classList.remove("hidden");
    atualizarTotais();
  }

  function voltarEtapa1() {
    esconderEtapas();
    document.getElementById("etapa1").classList.remove("hidden");
    atualizarTotais();
  }

  function voltarEtapa2() {
    esconderEtapas();
    document.getElementById("etapa2").classList.remove("hidden");
    atualizarTotais();
  }
  function esconderEtapas() {
    ["etapa1", "etapa2", "etapa3", "etapa4"].forEach(id => {
      const el = document.getElementById(id);
      if (el) el.classList.add("hidden");
    });
  }

  function atualizarTotais() {
    const mensalidadeComDesconto = parseFloat(localStorage.getItem("mensalidade_com_desconto")) || 0;
    const valorVeiculo = parseFloat(localStorage.getItem("valor_veiculo")) || 0;

    // Ajustar rastreador automaticamente
    if (valorVeiculo >= 70000) {
      document.getElementById("rastreadorSim").checked = true;
    }

    // Adicionar evento para recalcular ao mudar o rastreador
    document.querySelectorAll('input[name="rastreador"]').forEach(radio => {
      radio.addEventListener("change", () => {
        atualizarTotais();
      });
    });

    let adicionais = 0;
    const camposExtras = ["guincho", "terceiros", "rastreador", "vflr", "incendio", "bau"];
    camposExtras.forEach(campo => {
      const selecionado = document.querySelector(`input[name="${campo}"]:checked`);
      if (selecionado) {
        const valor = parseFloat(selecionado.value) || 0;
        if (campo === "rastreador" && selecionado.value === "30") {
          adicionais += 30; // Adicional fixo de 30,00 quando "Sim" é selecionado
        } else {
          adicionais += valor;
        }
      }
    });

    let descontos = 0;
    const adesivoCheckbox = document.getElementById("adesivo")?.checked || false;
    if (adesivoCheckbox) {
      const beneficios = document.querySelectorAll('input[name="beneficio"]:checked');
      beneficios.forEach(b => {
        descontos += parseFloat(b.value) || 0;
      });
    }
    descontos += (valorVeiculo >= 70000 && document.getElementById("rastreadorSim").checked ? 30 : 0); // Desconto fixo de 30,00 para veículos >= 70.000 quando "Sim" está marcado

    const subtotal = mensalidadeComDesconto + adicionais - descontos;

    // Atualiza visuais em todas as etapas
    document.querySelectorAll("#subtotalSeguro").forEach(el => {
      el.innerHTML = `Seguro: <span class="text-red-400 font-bold">R$ ${mensalidadeComDesconto.toFixed(2)}</span>`;
    });
    document.querySelectorAll("#subtotalDesconto").forEach(el => {
      el.innerHTML = `Descontos: <span class="text-green-300 font-bold">- R$ ${descontos.toFixed(2)}</span>`;
    });
    document.querySelectorAll("#subtotalAdicionais").forEach(el => {
      el.innerHTML = `Adicionais: <span class="text-red-400 font-bold">R$ ${adicionais.toFixed(2)}</span>`;
    });
    document.querySelectorAll("#subtotalFinal").forEach(el => {
      el.innerHTML = `Subtotal Final: <span class="text-white font-bold">R$ ${subtotal.toFixed(2)}</span>`;
    });
  }
  
  function enviarFormulario() {
    const nome = document.getElementById("cliente_nome").value.trim();
    const telefone = document.getElementById("cliente_telefone").value.trim();
    const placa = document.getElementById("cliente_placa").value.trim();
    const rua = document.getElementById("cliente_rua").value.trim();
    const numero = document.getElementById("cliente_numero").value.trim();
    const bairro = document.getElementById("cliente_bairro").value.trim();
    const cidade = document.getElementById("cliente_cidade").value.trim();
    const cep = document.getElementById("cliente_cep").value.trim();
    const uf = document.getElementById("cliente_uf").value.trim();
    const telefonePessoal = document.getElementById("cliente_telefone_pessoal").value.trim();
    const telefoneRecado = document.getElementById("cliente_telefone_recado").value.trim();
    const email = document.getElementById("cliente_email").value.trim();

    if (!nome || !telefone || !placa) {
      alert("Preencha todos os campos obrigatórios.");
      return;
    }

    // Obter subtotal final e opções escolhidas
    const subtotalFinal = parseFloat(document.getElementById("subtotalFinal").textContent.split("R$ ")[1]) || 0;
    const guincho = document.querySelector('input[name="guincho"]:checked')?.nextSibling.textContent.trim() || "200KM (R$0,00)";
    const terceiros = document.querySelector('input[name="terceiros"]:checked')?.nextSibling.textContent.trim() || "R$40.000 (R$0,00)";
    const rastreador = document.querySelector('input[name="rastreador"]:checked')?.nextSibling.textContent.trim() || "Não";
    const vflr = document.querySelector('input[name="vflr"]:checked')?.nextSibling.textContent.trim() || "Não (R$0,00)";
    const incendio = document.querySelector('input[name="incendio"]:checked')?.nextSibling.textContent.trim() || "Não (R$0,00)";
    const bau = document.querySelector('input[name="bau"]:checked')?.nextSibling.textContent.trim() || "Não (R$0,00)";
    const adesivo = document.getElementById("adesivo").checked ? "Sim" : "Não";
    const beneficios = Array.from(document.querySelectorAll('input[name="beneficio"]:checked')).map(b => b.nextSibling.textContent.trim()).join(", ") || "Nenhum";

    // Formatar mensagem para WhatsApp
    let mensagem = "Olá Áquila, tudo bem?\n";
    if (localStorage.getItem("plano_basico") === "false" && localStorage.getItem("mensalidade_original") === "0") {
      mensagem += "Desejo uma cotação da minha frota, [...]\n";
    } else {
      mensagem += `Realizei uma simulação e gostei da oferta! O valor final ficou em R$ ${subtotalFinal.toFixed(2)}, com as seguintes opções:\n`;
    }
    mensagem += `- Guincho: ${guincho}\n- Proteção a Terceiros: ${terceiros}\n- Rastreador: ${rastreador}\n- VFLR: ${vflr}\n- Incêndio e Alagamento: ${incendio}\n- Proteção para Baú: ${bau}\n- Adesivo: ${adesivo}\n- Benefícios: ${beneficios}\n\n`;
    mensagem += "Segue meus dados:\n";
    mensagem += `*Nome completo:* ${nome || "Não informado"}\n`;
    mensagem += `*Telefone:* ${telefone || "Não informado"}\n`;
    mensagem += `*Placa:* ${placa || "Não informado"}\n`;
    mensagem += `*Rua:* ${rua || "Não informado"}\n`;
    mensagem += `*Número:* ${numero || "Não informado"}\n`;
    mensagem += `*Bairro:* ${bairro || "Não informado"}\n`;
    mensagem += `*Cidade:* ${cidade || "Não informado"}\n`;
    mensagem += `*CEP:* ${cep || "Não informado"}\n`;
    mensagem += `*UF:* ${uf || "Não informado"}\n`;
    mensagem += `*Telefone pessoal:* ${telefonePessoal || "Não informado"}\n`;
    mensagem += `*Telefone de recado:* ${telefoneRecado || "Não informado"}\n`;
    mensagem += `*E-mail:* ${email || "Não informado"}\n\n`;
    mensagem += "Para finalizar, gostaria de saber se há alguma campanha ativa no momento. Já estou pronto para providenciar meu documento com foto (CNH ou RG) e o documento do veículo!";

    // Armazenar dados no localStorage
    localStorage.setItem("cliente_nome", nome);
    localStorage.setItem("cliente_telefone", telefone);
    localStorage.setItem("cliente_placa", placa);
    localStorage.setItem("cliente_rua", rua);
    localStorage.setItem("cliente_numero", numero);
    localStorage.setItem("cliente_bairro", bairro);
    localStorage.setItem("cliente_cidade", cidade);
    localStorage.setItem("cliente_cep", cep);
    localStorage.setItem("cliente_uf", uf);
    localStorage.setItem("cliente_telefone_pessoal", telefonePessoal);
    localStorage.setItem("cliente_telefone_recado", telefoneRecado);
    localStorage.setItem("cliente_email", email);

    // Direcionar para WhatsApp
    const numeroWhatsApp = "5527996437717";
    const urlWhatsApp = `https://wa.me/${numeroWhatsApp}?text=${encodeURIComponent(mensagem)}`;
    window.open(urlWhatsApp, '_blank');
  }

  // Inicialização
  window.onload = () => {
    const planoBasico = localStorage.getItem("plano_basico") === "true";
    const valorVeiculo = parseFloat(localStorage.getItem("valor_veiculo")) || 0;
    const mensalidadeComDesconto = parseFloat(localStorage.getItem("mensalidade_com_desconto")) || 0;

    // Garantir que os valores sejam carregados do localStorage
    if (mensalidadeComDesconto > 0) {
      localStorage.setItem("mensalidade_com_desconto", mensalidadeComDesconto.toFixed(2));
    }

    // Plano Básico pula etapas
    if (planoBasico) {
      document.querySelector('input[name="guincho"][value="0"]').checked = true;
      document.querySelector('input[name="terceiros"][value="0"]').checked = true;
      document.querySelector('input[name="vflr"][value="0"]').checked = true;
      document.querySelector('input[name="incendio"][value="0"]').checked = true;
      document.querySelector('input[name="bau"][value="0"]').checked = true;
      document.querySelector('input[name="rastreador"][value="0"]').checked = true;
      irParaEtapa1(); // Ajustado para ir para Etapa 1 (Adesivo)
    } else {
      irParaEtapa1();
    }

    // Inicializar os benefícios com base no estado do checkbox
    const adesivoCheckbox = document.getElementById("adesivo");
    if (adesivoCheckbox) {
      atualizarBeneficios(); // Chama a função para exibir ou ocultar os benefícios
      adesivoCheckbox.addEventListener("change", atualizarBeneficios); // Associa o evento de mudança
    }

    // Forçar atualização dos totais com os valores carregados
    atualizarTotais();
  };
  
    function atualizarBeneficios() {
      const adesivoCheckbox = document.getElementById("adesivo").checked;
      const beneficiosContainer = document.getElementById("beneficiosContainer");
      const beneficios = document.querySelectorAll('input[name="beneficio"]');

      beneficiosContainer.style.display = adesivoCheckbox ? "grid" : "none";
      beneficios.forEach(b => {
        b.checked = false;
        b.disabled = !adesivoCheckbox;
      });
      atualizarTotais();
    }

    // Limitar a 2 benefícios
    document.querySelectorAll('input[name="beneficio"]').forEach(checkbox => {
      checkbox.addEventListener("change", () => {
        const selecionados = document.querySelectorAll('input[name="beneficio"]:checked');
        if (selecionados.length > 2) {
          checkbox.checked = false;
          alert("Você pode escolher no máximo 2 benefícios.");
        }
        atualizarTotais();
      });
    });  
</script>
</body>
</html>
