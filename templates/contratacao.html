<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Contratação - Monte seu Plano</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-900 text-white font-sans min-h-screen flex flex-col items-center justify-center px-4">
  <div class="max-w-4xl w-full">
    <h1 class="text-3xl font-bold text-center mb-8">Monte seu plano</h1>

    <!-- Etapa 1: Serviços Principais -->
    <div id="etapa1" class="space-y-8">
      <h2 class="text-xl font-semibold mb-4">Serviços Inclusos</h2>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <!-- Guincho -->
        <div class="bg-white text-black rounded p-4">
          <h3 class="font-bold mb-2">Guincho</h3>
          <label class="block"><input type="radio" name="guincho" value="0"> 200KM (R$0,00)</label>
          <label class="block"><input type="radio" name="guincho" value="30"> 400KM (R$30,00)</label>
          <label class="block"><input type="radio" name="guincho" value="50"> 800KM (R$50,00)</label>
        </div>

        <!-- Proteção Terceiros -->
        <div class="bg-white text-black rounded p-4">
          <h3 class="font-bold mb-2">Proteção a Terceiros</h3>
          <label class="block"><input type="radio" name="terceiros" value="0"> R$40.000 (R$0,00)</label>
          <label class="block"><input type="radio" name="terceiros" value="30"> R$70.000 (R$30,00)</label>
        </div>

        <!-- Rastreador -->
        <div class="bg-white text-black rounded p-4">
          <h3 class="font-bold mb-2">Rastreador</h3>
          <label class="block"><input type="radio" name="rastreador" value="0"> Não</label>
          <label class="block"><input type="radio" name="rastreador" value="30"> Sim (R$30,00)</label>
        </div>
      </div>

      <div class="flex justify-end">
        <button onclick="irParaEtapa2()" class="mt-4 bg-blue-600 hover:bg-blue-700 text-white py-2 px-6 rounded font-semibold">Próxima</button>
      </div>
    </div>

    <!-- Etapa 2: Adicionais -->
    <div id="etapa2" class="space-y-8 hidden">
      <h2 class="text-xl font-semibold mb-4">Adicionais</h2>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <!-- VFLR -->
        <div class="bg-white text-black rounded p-4">
          <h3 class="font-bold mb-2">Vidros, Faróis, Lanternas e Retrovisores</h3>
          <label class="block"><input type="radio" name="vflr" value="0"> Não (R$0,00)</label>
          <label class="block"><input type="radio" name="vflr" value="20"> Sim (R$20,00)</label>
        </div>

        <!-- Incêndio e Alagamento -->
        <div class="bg-white text-black rounded p-4">
          <h3 class="font-bold mb-2">Incêndio e Alagamento</h3>
          <label class="block"><input type="radio" name="incendio" value="0"> Não (R$0,00)</label>
          <label class="block"><input type="radio" name="incendio" value="25"> Sim (R$25,00)</label>
        </div>

        <!-- Proteção Baú -->
        <div class="bg-white text-black rounded p-4">
          <h3 class="font-bold mb-2">Proteção para Baú (se aplicável)</h3>
          <label class="block"><input type="radio" name="bau" value="0"> Não (R$0,00)</label>
          <label class="block"><input type="radio" name="bau" value="90"> Sim (R$90,00)</label>
        </div>
      </div>

      <div class="flex justify-between">
        <button onclick="voltarEtapa1()" class="mt-4 bg-gray-600 hover:bg-gray-700 text-white py-2 px-6 rounded font-semibold">Voltar</button>
        <button onclick="irParaEtapa3()" class="mt-4 bg-blue-600 hover:bg-blue-700 text-white py-2 px-6 rounded font-semibold">Próxima</button>
      </div>
    </div>

    <!-- Etapa 3: Adesivo (única renderizada caso plano básico) -->
    <div id="etapa3" class="space-y-6">
      <h2 class="text-xl font-semibold mb-4">Adesivo</h2>

      <label class="flex items-center gap-2">
        <input type="checkbox" id="adesivo" class="form-checkbox text-blue-500" />
        Aceito adesivar meu veículo e ganhar benefícios
      </label>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <label class="bg-white text-black rounded p-4 block">
          <input type="checkbox" name="beneficio" value="-20" /> Desconto mensal de R$ 20,00
        </label>
        <label class="bg-white text-black rounded p-4 block">
          <input type="checkbox" name="beneficio" value="-20" /> VFLR incluso gratuitamente
        </label>
        <label class="bg-white text-black rounded p-4 block">
          <input type="checkbox" name="beneficio" value="0" /> R$1.000,00 de desconto na participação
        </label>
      </div>

      <div class="mt-8 bg-gray-800 p-4 rounded">
        <h3 class="text-lg font-semibold mb-2">Subtotal</h3>
        <p id="subtotalSeguro">Seguro: <span class="text-red-400 font-bold">R$ 0,00</span></p>
        <p id="subtotalDesconto">Descontos: <span class="text-green-300 font-bold">- R$ 0,00</span></p>
        <p id="subtotalAdicionais">Adicionais: <span class="text-red-400 font-bold">R$ 0,00</span></p>
        <p id="subtotalFinal">Subtotal Final: <span class="text-white font-bold">R$ 0,00</span></p>
      </div>

      <div class="mt-6 text-right">
        <button onclick="irParaEtapa4()" class="bg-green-600 hover:bg-green-700 text-white py-2 px-6 rounded font-semibold">Seguir com contratação</button>
      </div>
    </div>

    <!-- Etapa 4: Dados do Cliente -->
    <div id="etapa4" class="space-y-6 hidden">
      <h2 class="text-xl font-semibold mb-4">Preencha seus dados</h2>
    
      <div class="space-y-4">
        <input required id="cliente_nome" class="w-full p-2 rounded bg-gray-800 text-white" placeholder="Nome completo *" />
        <input required id="cliente_telefone" class="w-full p-2 rounded bg-gray-800 text-white" placeholder="Telefone com DDD *" />
        <input required id="cliente_placa" class="w-full p-2 rounded bg-gray-800 text-white" placeholder="Placa do veículo *" />
      </div>
    
      <p class="text-sm text-gray-300 mt-4">
        Preencha todos os campos para seguir com a contratação sem intermédio de um vendedor.<br />
        Se desejar contato com um representante, clique em finalizar após preencher nome, telefone e placa.<br />
        <strong>Não se preocupe</strong>, se houver descontos ou campanhas, iremos contatar!
      </p>
    
      <div class="mt-6 text-right">
        <button onclick="voltarEtapa3()" class="bg-gray-600 hover:bg-gray-700 text-white py-2 px-6 rounded font-semibold">Voltar</button>
        <button onclick="enviarFormulario()" class="bg-green-600 hover:bg-green-700 text-white py-2 px-6 rounded font-semibold">Finalizar</button>
      </div>
    </div>
  </div>

  <script>
    function atualizarTotais() {
      const mensalidadeOriginal = parseFloat(localStorage.getItem("mensalidade_original")) || 0;
      const mensalidadeComDesconto = parseFloat(localStorage.getItem("mensalidade_com_desconto")) || 0;

      let adicionais = 0;
      const camposExtras = ["guincho", "terceiros", "rastreador", "vflr", "incendio", "bau"];
      camposExtras.forEach(campo => {
        const selecionado = document.querySelector(`input[name=${campo}]:checked`);
        if (selecionado) adicionais += parseFloat(selecionado.value);
      });

      let desconto = mensalidadeOriginal - mensalidadeComDesconto;

      const adesivoAtivo = document.getElementById("adesivo").checked;
      if (adesivoAtivo) {
        const beneficios = document.querySelectorAll('input[name="beneficio"]:checked');
        beneficios.forEach(b => {
          desconto += parseFloat(b.value);
        });
      }

      const subtotal = mensalidadeComDesconto + adicionais;

      // Atualiza visuais
      document.getElementById("subtotalSeguro").innerHTML = `Seguro: <span class="text-red-400 font-bold">R$ ${mensalidadeComDesconto.toFixed(2)}</span>`;
      document.getElementById("subtotalDesconto").innerHTML = `Descontos: <span class="text-green-300 font-bold">- R$ ${desconto.toFixed(2)}</span>`;
      document.getElementById("subtotalAdicionais").innerHTML = `Adicionais: <span class="text-red-400 font-bold">R$ ${adicionais.toFixed(2)}</span>`;
      document.getElementById("subtotalFinal").innerHTML = `Subtotal Final: <span class="text-white font-bold">R$ ${(subtotal).toFixed(2)}</span>`;
    }

    function irParaEtapa4() {
      document.getElementById("etapa3").classList.add("hidden");
      document.getElementById("etapa4").classList.remove("hidden");
    }

    function voltarEtapa3() {
      document.getElementById("etapa4").classList.add("hidden");
      document.getElementById("etapa3").classList.remove("hidden");
    }

    function enviarFormulario() {
      const nome = document.getElementById("cliente_nome").value.trim();
      const telefone = document.getElementById("cliente_telefone").value.trim();
      const placa = document.getElementById("cliente_placa").value.trim();

      if (!nome || !telefone || !placa) {
        alert("Preencha todos os campos obrigatórios.");
        return;
      }

      // Apenas memorização por enquanto
      localStorage.setItem("cliente_nome", nome);
      localStorage.setItem("cliente_telefone", telefone);
      localStorage.setItem("cliente_placa", placa);

      // Aqui depois você envia para backend
      alert("Dados salvos com sucesso! Vamos configurar o envio depois.");
    }

    window.onload = () => {
      const rastreadorMarcado = localStorage.getItem("rastreador_checkbox") === "true";
      const adesivoMarcado = localStorage.getItem("adesivo_checkbox") === "true";
      const planoBasico = localStorage.getItem("plano_basico") === "true";

      if (adesivoMarcado) {
        document.getElementById("adesivo").checked = true;
      }

      const beneficios = document.querySelectorAll('input[name="beneficio"]');
      beneficios.forEach(opt => {
        opt.disabled = !adesivoMarcado;
      });

      // Limita a 2 benefícios
      document.querySelectorAll('input[name="beneficio"]').forEach(checkbox => {
        checkbox.addEventListener('change', () => {
          const selecionados = document.querySelectorAll('input[name="beneficio"]:checked');
          if (selecionados.length > 2) {
            checkbox.checked = false;
            alert("Você pode escolher no máximo 2 benefícios.");
          }
          atualizarTotais();
        });
      });

      document.getElementById("adesivo").addEventListener("change", () => {
        const ativo = document.getElementById("adesivo").checked;
        beneficios.forEach(opt => {
          opt.disabled = !ativo;
          if (!ativo) opt.checked = false;
        });
        atualizarTotais();
      });

      atualizarTotais();
    };
  </script>
</body>
</html>
